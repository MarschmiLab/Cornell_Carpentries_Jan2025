---
source: Rmd
title: "Writing Reports with R Markdown"
teaching: 0 
exercises: 0
questions: ""
objectives: ""
keypoints: ""
---

```{r, include=FALSE}
source("../bin/chunk-options.R")
knitr_fig_path("01-")
```

Recall that our ultimate goal is to generate a report on how a country's life expectancy is related to GDP.

## Creating a reports directory

Let's start by using the Unix Shell to create a directory within `un-report` called `reports` where we will write our reports to the UN.
First, open the Unix Shell and `cd` to `un-report`

```
pwd
mkdir reports
```

```
/home/USERNAME/Desktop/un-report/reports/
```
TODO make this input and output look like SWC website.

To start, I have a question for you:
How do you usually share data analyses with your collaborators? 
Many people share them through a Word document, a spreadsheet, slides, a  graphic, etc. 

## Why use R Markdown?

We're going to learn a way to create a report in R using something called R Markdown. 
This allows you to integrate the text of the report, the code you used, and your figures and other output into one document, which you can then "render" into a html or PDF file and share with others. 
The text can be experimental methods, an analysis and discussion of the results, or whatever else you want to include.
:We use this for writing reproducible analysis reports, publication, sharing work with collaborators, writing up homework, and keeping a computational notebook of our work, among other things.
If you're writing a publication or sharing results with collaborators who won't be interested in seeing that nitty-gritty part of your work, you can even hide the code. 
We call these types of reports *reproducible* reports because the code is embedded in the document and anyone can take the report and re-run the code to get the same output. 
It's also useful because if you change any of your code or text because you found an error or want to modify the text or a figure, you can just re-run the report to get the updated output! 

R Markdown combines Markdown (which renders plain text) with R code, which you can use to do data analysis and make figures.

## Creating an R Markdown file

Now that we have a better understanding of what we can use R Markdown files for, let's start writing a report!

To create an R Markdown file: (TODO: Include screen shots or is that overkill? If you demo live, i (Jule) don't think you need screenshots.)
- Open RStudio
- Go to File &rarr; New File &rarr; R Markdown
- Give your document a title (Q for learners: what should we call it? - TODO: choose name - un-report? Maybe: "A UN Report on the Relationship between GDP and Life Expectancy") ## i think it is important to make clear here that this title is different from a file or directory name?
- Keep the default output format as HTML. You need TeX installed if you want to generate PDF documents. (TODO: Add link to [how to install TeX](https://www.latex-project.org/get/)/[render PDFs](https://rmarkdown.rstudio.com/pdf_document_format.html%2F), general link on [R Markdown output formats](https://rmarkdown.rstudio.com/lesson-9.html))
- R Markdown files always end in `.Rmd`

## Basic components of R Markdown

### Header

The first part is a *header* at the top of the file between the lines of `---`. This contains instructions for R to specify the type of document to be created and options to choose (ex. title, author, date). These are in the form of key-value pairs (`key: value`; YAML).

Here's an example:

```
---
title: 'Writing Reports with R Markdown'
author: "Zena Lapp"
date: "11/18/2020"
output: html_document
---
```

### Code chunks

The next section is a *code chunk*, or embedded R code, that sets up options for all code chunks. Here is the default when you create a new R Markdown file:

```{r,comment=NA,echo=F,collapse=T}
cat('```{r setup, include=FALSE}\n')
cat('knitr::opts_chunk$set(echo = TRUE)\n')
cat('```\n')
```

All code chunks have this format:

```{r,comment=NA,echo=F,collapse=T}
cat('```{r}\n# Your code here\n```')
```

All of the code is enclosed in 3 backticks (`cat('```')`), and the `{r}` part indicates that it's a chunk of R code. 

You can also include other information within the curly brackets to indicate different information about that code chunk. 
For instance, the first code block is named "setup", and `include=FALSE` prevents code and results from showing up in the output file.

Inside the code chunk, you can put any R code that you want to run, and you can have as many code chunks as you want in your file.

As we mentioned above, in the first code chunk you set options for the entire file. 
`echo = TRUE` means that you want your code to be shown in the output file. 
There are also many other options that you can change, but we won't go into those details in this workshop. 
TODO: Check link on where we can learn more: [See here on code chunks in R Markdown](https://rmarkdown.rstudio.com/lesson-3.html)

### Text

Finally, you can include text in your R Markdown file. 
This is any text or explanation you want to include, and it's formatted with Markdown. 
We'll learn more about Markdown formatting soon!

## Starting the report

First, let's delete everything below the setup code chunk.

Next, let's save our R markdown file to the `reports` directory. 
You can do this by clicking the save icon in the top left. 

There's one other thing that we need to do before we get started with our report.
To render our documents into html format, we can "knit" them in R Studio. 
Usually, R Markdown renders documents from the directory where the document is saved (the location of the `.Rmd` file), but we want it to render from the main project directory where our `.Rproj` file is.
This is because that's where all of our relative paths are from and it's good practice to have all of your relative paths from the main project directory.
To change this default, click on the down arrow next to the "Knit" button at the top left of R Studio, go to "Knit Directory" and click "Project Directory". 
Now it will assume all of your relative paths for reading and writing files are from the `un-report` directory, rather than the `reports` directory.

Now that we have that set up, let's start on the report!

We're going to use the code you generated yesterday to plot GDP vs Life Expectancy to include in the report. Recall that we needed a couple R packages to generate these plots. We can create a new code chunk to library the needed packages. You could also include this in the previous setup chunck, it's up to your personal preference. We can specify `include=FALSE` like the setup chuck so we dont see the messages from loading packages in the report output. 

```{r,comment=NA,echo=F,collapse=T}
cat('```{r packages, include=FALSE}\n')
cat('library(tidyverse)\n')
cat('```\n')
```

Now in a real report this is when we would type out the background and purpose of the report to provide context to the readers of the report. However, since writing is not a focus of this workshop we will avoid lengthy prose and stick to short descriptions. You can copy the text below into your report below the package code chunk.

```
(couple sentances with purpose/question/hypothesis for the report that can be copied and pasted into the report)
```

Now since we want to show our results comparing GDP and life expectancy by country, we need to read in this data so we can regenerate our plot. We will add another code chunk to prepare the data. 

```{r,comment=NA,echo=F,collapse=T}
cat('```{r data}\n')
cat('gapminder_1997 <- read.csv("./data/gapminder_1997.csv")\n')
cat('```\n')
```

Now that we have the data we need to produce the plot, let's create it!

```{r,comment=NA,echo=F,collapse=T}
cat('```{r gdp_lifeexp_1997}\n')
cat('ggplot(data = gapminder_1997) + \n
  aes(x = gdpPercap, y = lifeExp, color=continent, size=pop/1000000) +\n
  geom_point() +\n
  labs(x = "GDP Per Capita", y = "Life Expectancy",\n
       title= "Do people in wealthy countries live longer?", size="Population (in millions)")\n')
cat('```\n')
```

Now we can knit our document to see how our report looks
TODO: add in using the knit button and changing knit directory or rmarkdown::render('file.rmd', output_dir = "dirpath/")

![](../fig/r-markdown/first_report_render.png)

Amazing! We've created a report! Lets push this to GitHub to make sure we preserve this document. 

TODO: check below instructions for pushing to GitHub
Now all we need to do is commit our recent changes and update our remote repository using Git.

Returning to the command line, type
`git status` ##to get an idea of which files just changed`
`git add <filename(s)>` ##to add any file(s) that you just created and that are not yet version controlled
`git commit -m "<your commit message>"` ##to describe the changes you are just committing and add them to the git log
`git push` ##to update your changes to the git directory on the remote server


It's looking pretty good, but there seem to be a few extra bits that we don't need in the report. For example, the report shows that we load the tidyverse package and the accompanying messages. 

![](../fig/r-markdown/tidyverse_messages.png)

To get rid of this, we can revise our packages code chunk by adding `include=FALSE` like in the setup chunk to prevent code and messages in this chunk from showing up in our report. 

```{r,comment=NA,echo=F,collapse=T}
cat('```{r packages, include=FALSE}\n')
cat('library(tidyverse)\n')
cat('```\n')
```

We can also see the code that was used to generate the plot. Depending on the purpose and audience for your report, you may want to include the code. If we dont want to code to appear, how can prevent it? What happens if we add `include=FALSE` to the plot code chunk, too?

![](../fig/r-markdown/includeFalse.png)

Oops! Now the plot doesn't show up in our report. This is because setting `include=FALSE` prevents anything in the code chunk from appearing in the report. Instead we can add `echo=FALSE` for the code chunk to tell it that we don't want to see the code but we want to see the output.

```{r,comment=NA,echo=F,collapse=T}
cat('```{r gdp_lifeexp_1997, echo=FALSE}\n')
cat('ggplot(data = gapminder_1997) + \n
  aes(x = gdpPercap, y = lifeExp, color=continent, size=pop/1000000) +\n
  geom_point() +\n
  labs(x = "GDP Per Capita", y = "Life Expectancy",\n
       title= "Do people in wealthy countries live longer?", size="Population (in millions)")\n')
cat('```\n')
```

When we knit this again, we can see the plot again!

![](../fig/r-markdown/echoFalse.png)
Now that we have a report we are happy with, let's push the changes to GitHub. 

TODO: Add a list of conclusions, possibly with some bold/italicized text to the end to learn more Markdown formatting. 

## Integrating it all together: Paired exercise

You've learned so much in the past two days - how to use the Unix Shell to move around your computer, how to use git for version control and GitHub for collaborating with others on code, how to make pretty plots and do data analysis in R, and how to incorporate it all into a report. 
Now, you're going to work in pairs to practice everything you learned. Ideally, you'll have the same pair as for the git/GitHub lesson.
Don't worry - if you have questions, the instructor and helpers can help you out!

Only one of the people in your pair is going to create the R Markdown file. The other person is going to collaborate with that person using GitHub. So the first step is to choose one person in your pair to create/host the R Markdown file.

**For the person who is going to host the new R Markdown file:**
1. Make a new R markdown file.
1. Give it an informative title.
1. Delete all the unnecessary Markdown and R code (everything below the setup R chunk).
1. Save it to the `reports` directory using an informative file name.

**For the person who is going to collaborate with the host of the R Markdown file:**

If you don't already have your partner's GitHub repo cloned from the git/GitHub lesson, clone their repo to your Desktop under the name `USERNAME-un-report`. If you don't remember how to do this, you can review the [git lesson](_episodes/03-intro-git-github.md). 

The way you will collaborate with each other is as follows:
1. For each exercise, both people will be thinking about how to answer the question, but only one person will be writing the code.
This is called _paired programming_.
1. Once you have completed an exercise, the person working on the exercise will add, commit, and push the changes to GitHub.
1. Then the other person will pull the changes from GitHub.
1. The person who pulled changes will code for the next exercise. 
1. Repeat the process for as many exercises as you can finish in the remaining time. 
Don't worry if you don't finish all of the exercises, and it's not a race between groups! 
This is just a way for you to practice what you've learned.

**One note:** It may be helpful to copy and paste the questions into the R Markdown file as you go.


TODO: *check if numbers reset after solution blocks*
TODO: *make sure r code works in solution blocks* 

### Exercises using the gapminder data

First we're going to start out with a few questions about the gapminder dataset.

1. The very first step is to read in the gapminder dataset, so don't forget! Also load the `tidyverse` package.

> ## Solution
> ```{r}
> library(tidyverse)
> gapminder <- read_csv('data/gapminder_data.csv')
> ```
{: .solution}

#### Investigating population over time.

1. Make a scatter plot of year vs. population, separated into a plot for each contient. **HINT:** you can use `facet_wrap(~column_name)` to separate into different plots based on that column.

> ## Solution
> ```{r}
> ggplot(gapminder, aes(x=year,y=pop)) + 
> geom_point() + 
> facet_wrap(~continent)
> ```
{: .solution}

1. It seems like there are 2 outliers - which countries are those?

> ## Solution
>```{r}
> gapminder %>% filter(pop > 1e9) %>% select(country) %>% unique()
> ```
{: .solution}

1. Plot year vs. population separated into a plot for each continent but excluding the 2 outlier countries. 

> ## Solution
> ```{r}
> gapminder %>% filter(country != 'China' & country != 'India') %>% ggplot(aes(x=year,y=pop)) + 
> geom_point() + 
> facet_wrap(~continent)
> ```
{: .solution}


##### Bonus questions: come back to these if you have time at the end

1. In the plot above, the years look kind of messy. Can you rotate the x axis text 90 degrees so that the years are more readable? Feel free to search the internet if you don't know how to do it!

> Solution
```{r}
gapminder %>% filter(country != 'China' & country != 'India') %>% ggplot(aes(x=year,y=pop)) + geom_point() + facet_wrap(~continent) + theme(axis.text.x=element_text(angle=90))
```
{: .solution}

1. It's hard to see which country is which here. Can you change the scatter plot to a line plot so we can get a better sense of trends over time? HINT: This website has more information: https://www.r-graph-gallery.com/line-chart-several-groups-ggplot2.html

> ## Solution
> ```{r}
> gapminder %>% filter(country != 'China' & country != 'India') %>% ggplot(aes(x=year,y=pop,group=country)) + 
> geom_line() + 
> facet_wrap(~continent) + 
> theme(axis.text.x=element_text(angle=90))
> ```
{: .solution}

#### Looking into life expectancy a bit more.

1. What country had the highest life expectancy in 1982? Hint: use the `slice_max` function to get the row for a maximum value in a dataset. You can use `?slice_max` and/or the internet to learn more about how to use the function.

> ## Solution
> ```{r,comment=NA,echo=F,collapse=T}
> filter(gapminder, year==1982) %>% slice_max(lifeExp)
> ```
{: .solution}

1. Now, do the same thing but for all years! *HINT:* Use the `group_by` function. 
TODO: See if they learn `group_by`.

> ## Solution
> ```{r}
> gapminder %>% group_by(year) %>% select(country,year,lifeExp) %>% slice_max(lifeExp) %>% print(n=Inf)
> ```
{: .solution}

1. Make a boxplot for the life expectancies of the countries in Asia for each year (year is the x axis, life expectancy is the y axis). Also fix the x and y axis labels.

> ## Solution
> ```{r,comment=NA,echo=F,collapse=T}
> gapminder %>% filter(continent=='Asia') %>% > ggplot(aes(x=as.character(year),y=lifeExp)) + 
> geom_boxplot() + 
> ylab('Life expectancy') + 
> xlab('')
> ```
{: .solution}

##### Bonus questions: come back to these if you have time at the end

1. What are the outliers in life expectancy in Asia for each year (lower life expectancy)?

> ## Solution
> ```{r}
> gapminder %>% filter(continent == 'Asia') %>% group_by(year) %>% slice_min(lifeExp)
> ```
{: .solution}

1. Make a boxplot for the life expectancies of the countries over time for each continent separately. Try to fix the x and y axis labels and text too. Feel free to change the theme if you'd like.

> ## Solution
> ```{r,comment=NA,echo=F,collapse=T}
> gapminder %>% ggplot(aes(x=as.character(year),y=lifeExp)) + 
> geom_boxplot() + 
> facet_wrap(~continent) + 
> theme_bw() + 
> theme(axis.text.x=element_text(angle=90)) + 
> xlab('') + 
> ylab('Life expectancy')
> ```
{: .solution}

1. Which country has had the greatest increase in life expectancy from 1952 to 2007? _HINT:_ You might want to use the `pivot_wider` function to get your data in a format with columns for: country, 1952 life expectancy, 2007 life expectancy, and the difference between 2007 and 1992 life expectancy. 
TODO: Move this to the end? 

> ## Solution
> ```{r,comment=NA,echo=F,collapse=T}
> filter(gapminder, year == 1952 | year == 2007) %>% select('country','year',lifeExp) %>% pivot_wider(names_from=year,values_from=lifeExp) %>% mutate(diff=`2007`-`1952`) %>% slice_max(diff)
> ```
{: .solution}

1. What countries had a decrease in life expectancy from 1952 to 2007?

> ## Solution
> ```{r,comment=NA,echo=F,collapse=T}
> filter(gapminder, year == 1952 | year == 2007) %>% select('country','year',lifeExp) %>% pivot_wider(names_from=year,values_from=lifeExp) %>% mutate(diff=`2007`-`1952`) %>% filter(diff < 0)
> ```
{: .solution}

### Exercises integrating a new dataset

**If you finished the questions involving the gapminder datset (Bonus questions are optional), move on to these questions next. Note that we don't expect you to finish all of these! You can also use them as practice after the workshop if you'd like.**

Now that you've practiced what you've learned with the gapminder data, you're going to start using a new dataset. 

TODO: 
- [ ] check with R analysis team for the CO2 data format after that part of workshop
- [ ] cut down number of questions (there is likely not enough time for all of the followings)
- [ ] check with R plotting and stats to make sure the contents has been covered before the exercises

#### Preview of the data

This dataset has information on the gross domestic expenditure on research and development (R&D) for different countries. We're going to use it to practice the data analysis workflow that you learned over the course of the workshop.

_Data:_ Gross domestic expenditure onresearch and development (R & D)

_Data source:_ [UN data](data.un.org), under "Science and technology"

_Data path:_ `data/SYB63_286_202009_GDP_on_RnD.csv`

Raw csv file:

```
T27,Gross domestic expenditure on research and development (R&D),,,,,
Region/Country/Area,,Year,Series,Value,Footnotes,Source
1,"Total, all countries or areas",2005,Gross domestic expenditure on R & D: as a percentage of GDP (%),1.5261,,"United Nations Educational, Scientific and Cultural Organization (UNESCO), Montreal, the UNESCO Institute for Statistics (UIS) statistics database, last accessed June 2020."
1,"Total, all countries or areas",2010,Gross domestic expenditure on R & D: as a percentage of GDP (%),1.6189,,"United Nations Educational, Scientific and Cultural Organization (UNESCO), Montreal, the UNESCO Institute for Statistics (UIS) statistics database, last accessed June 2020."
...
32,Argentina,2017,Gross domestic expenditure on R & D: Business enterprises (%),16.5161,,"United Nations Educational, Scientific and Cultural Organization (UNESCO), Montreal, the UNESCO Institute for Statistics (UIS) statistics database, last accessed June 2020."
...
```

`gapminder` dataset preview:

```
> head(gapminder)
# A tibble: 6 x 6
  country     continent  year lifeExp      pop gdpPercap
    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>
    1 Afghanistan Asia       1952    28.8  8425333      779.
    2 Afghanistan Asia       1957    30.3  9240934      821.
    3 Afghanistan Asia       1962    32.0 10267083      853.
    4 Afghanistan Asia       1967    34.0 11537966      836.
    5 Afghanistan Asia       1972    36.1 13079460      740.
    6 Afghanistan Asia       1977    38.4 14880372      786.
```

CO2 dataset (UN data) preview:

```
T24,CO2 emission estimates,,,,,
Region/Country/Area,,Year,Series,Value,Footnotes,Source
8,Albania,1975,Emissions (thousand metric tons of carbon dioxide),4338.3340,,"International Energy Agency, IEA World Energy Balances 2019 and 2006 IPCC Guidelines for Greenhouse Gas Inventories, last accessed June 2020."
8,Albania,1985,Emissions (thousand metric tons of carbon dioxide),6929.9260,,"International Energy Agency, IEA World Energy Balances 2019 and 2006 IPCC Guidelines for Greenhouse Gas Inventories, last accessed June 2020."
```

#### Reading in and cleaning the data

1. First, read in the data. Note that you need to skip the first line of the file because that's just a title for the whole dataset (see above). Also rename the columns to something more informative (as you learned, there are lots of ways to do this, and different preferences - feel free to use whichever method you want!).

> ## Solution
> ```{r}
> rnd <- read_csv('data/rnd-un-data.csv', skip = 1) %>% rename(country=X2) %>% rename_all(tolower)
> ```
{: .solution}

1. Next, take a look at the `series` column (or whatever you renamed it to), and make the titles shorter and with no spaces to make them easier to work with.

> ## Solution
> ```{r}
> rnd <- rnd %>% mutate(series=recode(series,
               "Gross domestic expenditure on R & D: as a percentage of GDP (%)" = 'gdp_pct', 
"Gross domestic expenditure on R & D: Business enterprises (%)" = 'business', 
"Gross domestic expenditure on R & D: Government (%)" = 'government', 
"Gross domestic expenditure on R & D: Higher education (%)" = 'higher_ed', 
"Gross domestic expenditure on R & D: Funds from abroad (%)" = 'abroad', 
"Gross domestic expenditure on R & D: Not distributed (%)" = 'not_distributed', 
"Gross domestic expenditure on R & D: Private non-profit (%)" = 'non_profit'))
> ```
{: .solution}

1. Next, make a column for each of the data types in the `series` column (or whatever you renamed it to). This shoudl give you the following columns: conuntry name, year, expenditure in general, % of funds from business, % of funds from government, % of funds from higher ed, % of funds from non-profit, % of funds from abroad, % of funds from non-specified sources.

> ## Solution
> ```{r}
> rnd <- rnd %>% pivot_wider(names_from=series,values_from=value)
> ```
{: .solution}

Note that there is a lot of missing data.  

Now we have our data set up in a way that makes it easier to work with. Feel free to clean up the data more before moving on to the next step if you'd like.

#### Plotting with the R & D dataset

1. Plot the distribution of percent expenditure using a histogram. Observe the range and how heavy the "tails" are. **Note:** you will likely get a note and a warning. Feel free to change the number of bins as the note describes. Why do you get warnings? (Hint: Look at the column you're plotting.). **Bonus:** Plot the same exact data in a way in which you don't get warnings. 

> ## Solution
> ```{r}
> rnd %>% filter(!is.na(gdp_pct)) %>% ggplot(aes(x=gdp_pct)) + 
> geom_histogram(bins=30)
> ```
{: .solution}

1. Plot the expenditure by year (discrete x vs continuous y) using a scatter plot. Feel free to try to make the plot more legible if you want. 

> ## Solution
> ```{r}
> rnd %>% filter(!is.na(gdp_pct)) %>% ggplot(aes(x=as.character(year), y=gdp_pct)) + 
> geom_point(alpha=0.5) + 
> xlab('')
> ```
{: .solution}

1. Plot the expenditure by year (discrete x vs continuous y) using a violin plot or a boxplot.

> ## Solution
> ```{r}
> rnd %>% filter(!is.na(gdp_pct)) %>% ggplot(aes(x=as.character(year), y=gdp_pct)) + 
> geom_violin() + 
> xlab('')
> ```
{: .solution}

### Combining the CO2 and R&D datasets datasets together

Now we're going to work with the C)2 and R&D datasets together. 

Unfortunately, we don't have the exact same dates for all of them. 

1. First, read in the CO2 dataset. You can use the code from the [R for data analysis](_episodes/04-r-data-analysis.md) lesson to clean the C02 data.

> ## Solution
> ```{r}
> # read in and clean CO2 data
> co2 <- read_csv("data/co2-un-data.csv", skip=2,
col_names=c("region", "country", "year", "series", "value", "footnotes", "source")) %>%
select(country, year, series, value) %>%
mutate(series = recode(series, "Emissions (thousand metric tons of carbon dioxide)" = "total",
"Emissions per capita (metric tons of carbon dioxide)" = "per_capita")) %>%
pivot_wider(names_from=series, values_from=value)
> ```
{: .solution}

1. Merge the CO2 dataset and the R&D dataset together. Keep only the following colums: country, year, total CO2 emissions, CO2 emissions per capita, and percent of GDP used for R&D. 

> ## Solution
> ```{r}
> co2_rnd <- full_join(co2, rnd) %>% select(country, year, total, per_capita, gdp_pct)
> ```
{: .solution}

1. You might have noticed that we don't have both C02 data _and_ R&D data for all years. Filter the merged dataset so that you only keep country/year combinations that have bot C02 and R&D data.

> ## Solution
> ```{r}
> co2_rnd <- co2_rnd %>% filter(!is.na(total) & !is.na(gdp_pct))
> ```
{: .solution}

1. How many countries per year do you have after filtering? **HINT:** You can use `summarize(count=n())` to help you out. 

> ## Solution
> ```{r}
> co2_rnd %>% group_by(year) %>% summarize(count=n()) 
> ```
{: .solution}

#### Plotting with the CO2 and R&D datasets together

1. Plot R&D expenditure vs. CO2 emission for each country using a scatter plot. You can choose total or per-capita CO2 emissions, or both. Make sure you have informative x and y axis labels.

> ## Solution
> ```{r}
> ggplot(co2_rnd, aes(x=gdp_pct,y=per_capita)) + 
> geom_point() + 
> ylab('Per-capita CO2 emissiosn') + 
> xlab('Percent of GDP spent on R&D')
> ```
{: .solution}

1. Next, facet the above plot by year.

> ## Solution
> ```{r}
> ggplot(co2_rnd, aes(x=gdp_pct,y=per_capita)) + 
> geom_point() + 
> ylab('Per-capita CO2 emissiosn') + 
> xlab('Percent of GDP spent on R&D') + 
> facet_wrap(~year)
> ```
{: .solution}

1. Identify the countries that have 5 time points for both C02 emissions and R&D.

> ## Solution
> ```{r}
> co2_rnd %>% group_by(country) %>% summarize(count=n()) %>% filter(count==5)
> ```
{: .solution}

**BONUS**

1. For the 3 countries you identified, plot the Percent of GDP spent on R&D and the per-capita CO2 emissions over time on the same plot. Color the two different values differently. **HINT:** Use `pivot_longer` to get the data in the right format. 

TODO: Fix names of colors?

> ## Solution
> ```{r}
> co2_rnd %>% filter(country %in% c('Azerbaijan','Cuba','Panama')) %>% pivot_longer(c(per_capita,gdp_pct)) %>% ggplot(aes(x=year,y=value,col=name)) + 
> geom_point() + 
> facet_wrap(~country)
> ```
{: .solution}


#### Bonus questions

1. For the R&D dataset, each country can have data for one or multiple years. What is the range of numbers of yearly data points for each country, and how many countries there are for each value within the range? (e.g. x countries have 2 different years and y have 5 years)

1. After merging the data sets, there is some missing data, how many `NA`s are present in each data column for the R&D data set? How may these missing data affect our intuitive obsevation in a plot and/or summary statistics? (e.g. `ggplot` removes `NA`s but stat functions (e.g. `median()` often ask for specific input regarding to how to deal with `NA`s)).

1. What countries have the highest and lowest data availabilities? (How would you measure data availability?) 

1. Add in the gapminder dataset and color the scatter plots we made above by continent, also facet by continent.

1. For a specific contient (e.g. Europe), show the importance of business and government funding for R&D. Do this using a stacked bar plot.

1. Create an R Markdown report with some of the information from these exercises. Decide excatly what you want to focus your report on, and then also perform additional analyses to include in your report. Also make sure your figures are legible and understandable!
   
