---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 04-r-data-analysis.md in _episodes_rmd/
source: Rmd
title: "R for Data Analysis"
teaching: 120
exercises: 45
questions: ""
objectives: ""
keypoints: ""
---




## Why use dplyr functions

Yesterday we spent a lot of time making plots in R using the ggplot2 package. Plots are very useful tools for looking at data, but sometimes we want to work more directly with it.

We may either need to clean up messy data or we might want to extract useful summary statistics. Today we will learn to use the dplyr package to accomplish this

In order to start, we will create a new RScript file. Open RStudio. Choose "File" > "New File" > "R Script".

TODO: *Confirm data paths for gapminder data file*
We will start by importing the complete gapminder dataset that we used yesterday into our new fresh R session. Try running the following command (using the correct path to your data file)


~~~
gapminder_data <- read_csv("data/gapminder_data.csv")
~~~
{: .language-r}



~~~
Error in read_csv("data/gapminder_data.csv"): could not find function "read_csv"
~~~
{: .error}
If we look in the console now, we'll see we've recieved an error message saying that R "could not find the function `read_csv()".

> ## Assessment: Why do we get this error message?
*Hint: Packages...*
>> Assessment Answer: What this means is that R cannot find the function we are trying to call. The reason for this usually is that we are trying to run a function from a package that we have not yet loaded.
>> This is a very common error message that you will probably see a lot when using R. It's important to remember that you will need to load any packages you want to use into R each time you start a new session.
>> The `read_csv` function comes from the *readr* package which is included in the *tidyverse* package so we will just load the*tidyverse* package and run the import code again.
> {: .source}
{: .keypoints}


~~~
library(tidyverse)
~~~
{: .language-r}



~~~
â”€â”€ [1mAttaching packages[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.3.0 â”€â”€
~~~
{: .output}



~~~
[32mâœ”[39m [34mggplot2[39m 3.3.3     [32mâœ”[39m [34mpurrr  [39m 0.3.4
[32mâœ”[39m [34mtibble [39m 3.0.4     [32mâœ”[39m [34mdplyr  [39m 1.0.2
[32mâœ”[39m [34mtidyr  [39m 1.1.2     [32mâœ”[39m [34mstringr[39m 1.4.0
[32mâœ”[39m [34mreadr  [39m 1.4.0     [32mâœ”[39m [34mforcats[39m 0.5.0
~~~
{: .output}



~~~
â”€â”€ [1mConflicts[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
[31mâœ–[39m [34mdplyr[39m::[32mfilter()[39m masks [34mstats[39m::filter()
[31mâœ–[39m [34mdplyr[39m::[32mlag()[39m    masks [34mstats[39m::lag()
~~~
{: .output}



~~~
gapminder_data <- read_csv("data/gapminder_data.csv")
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  pop = [32mcol_double()[39m,
  continent = [31mcol_character()[39m,
  lifeExp = [32mcol_double()[39m,
  gdpPercap = [32mcol_double()[39m
)
~~~
{: .output}
Let's say we would like to know what is the mean (average) life expecteny in the dataset. R has a built in function function called `mean()` that will calculate this value for us. We can apply that function to our *lifeExp* column using the `summarize` function. Here's what that looks like

~~~
gapminder_data %>%
  summarize(average=mean(lifeExp))
~~~
{: .language-r}



~~~
[90m# A tibble: 1 x 1[39m
  average
    [3m[90m<dbl>[39m[23m
[90m1[39m    59.5
~~~
{: .output}
This command is made of several parts. First, we start with our data object (gapminder_data). Then, we use a special operator called the *pipe operator* `%>%` to pass the data value into the `summarize` function. The pipe operator allows us to "chain" together multiple function calls so that the output of the first function becomes the input to the next function.

> ## Exercise: why use a pipe operator?
> You could also write the above code in the following way
> 
> ~~~
>   summarize(gapminder_data, average=mean(lifeExp))
> ~~~
> {: .language-r}
> 
> 
> 
> ~~~
> [90m# A tibble: 1 x 1[39m
>   average
>     [3m[90m<dbl>[39m[23m
> [90m1[39m    59.5
> ~~~
> {: .output}
> Here we pass the data directly to `summarize()` as an argument rather than piping the value.
> But as soon as we start writing more functions, we will see that using pipes makes this easier to read.
> {: .source}
{: .callout}

 Since we use the pipe operator so often, there is a keyboard shortcut for it in RStudio. You can press <kdb>Ctrl</kdb>+<kdb>Shift</kdb>+<kdb>M<kdb> on Windows or <kdb>Cmd<kdb>+<kdb>Shift<kdb>+<kdb>M<kdb> on a Mac.

When we call `summarize`, we can use any of the column names of our data object as values to pass to other functions. `summarize()` will return a new data object and our value will be returned as a column.
We name this new column so we can use in a future argument. So the `average=` part tells `summarize()` to use "average" as the name of the new column.

Note that you don't have to quotes around this new name as long as it starts with a letter and doesn't include a space.

> ## Exercise: What if you want to use spaces or other characters in the column names?
>> If you do want to use spaces or other characters, You should wrap the name in quotes.
>> 
>>

But let's get back to the value we just calculated. We saw that the average life expectency for all rows in the data was 59.5. That seems a bit low, doesn't it? What's going on?
Well, remember the dataset contains rows from many different years and many different countries. It's likely that life expecency has increased overtime, so it may not make sense to average over all the years at the same time.

Let's use summarize to find the most recent year in the data set. We can use the `max()` function to return the maximum value.


~~~
gapminder_data %>%
  summarize(recent_year=max(year))
~~~
{: .language-r}



~~~
[90m# A tibble: 1 x 1[39m
  recent_year
        [3m[90m<dbl>[39m[23m
[90m1[39m        [4m2[24m007
~~~
{: .output}
So we see that the most recent year in the dataset is 2007. Let's calculate the life expecteny for all countries for only that year. To do that, we will use the `filter()` function to only use rows for that year before calculating the mean value.


~~~
gapminder_data %>%
  filter(year == 2007) %>%
  summarize(average=mean(lifeExp))
~~~
{: .language-r}



~~~
[90m# A tibble: 1 x 1[39m
  average
    [3m[90m<dbl>[39m[23m
[90m1[39m    67.0
~~~
{: .output}

> ##Challenge: What is the average GDP per capita for the first year in the dataset?
>>
>>~~~
>>gapminder_data %>%
>>  summarize(first_year=min(year))
>>~~~
>>{: .language-r}
>>
>>
>>
>>~~~
>>[90m# A tibble: 1 x 1[39m
>>  first_year
>>       [3m[90m<dbl>[39m[23m
>>[90m1[39m       [4m1[24m952
>>~~~
>>{: .output}
>>
>>
>>
>>~~~
>>gapminder_data %>%
>>  filter(year == 1952) %>%
>>  summarize(average_gdp=mean(gdpPercap))
>>~~~
>>{: .language-r}
>>
>>
>>
>>~~~
>>[90m# A tibble: 1 x 1[39m
>>  average_gdp
>>        [3m[90m<dbl>[39m[23m
>>[90m1[39m       [4m3[24m725.
>>~~~
>>{: .output}
> {: .source}
{: .challenge}



Notice how the pipe operator (`%>%`) allows us to combine these two simple steps into a more complicated data extration. We take the data, then filter out the rows, then take the mean value. The argument we pass to `filter()` needs to be some expression that will return TRUE or FALSE. We can use comparisons like `>` (greater than) and `<` (less than) for example. Here we tested for equality using a double equals sign `==`. You use `==` (double equals) when testing if two values are equal, and you use `=` (single equals) when naming arguments that you are passing to functions). Try changing it to use `filter(year = 2007)` and see what happens.

We see that this value is much larger than the value we got using all of the rows. So it seems life expectency is increasing which is good news. But now we might be intereted calculating the average for each year. Rather that doing a bunch of different `filter()` staments, we can instead use the `group_by` function. The funtion allows us to tell the code to treat the rows in logical groups, so rather than summarizing over all the rows, we will get one summary value for each group. Here's what that will look like


~~~
gapminder_data %>%
  group_by(year) %>%
  summarize(average=mean(lifeExp))
~~~
{: .language-r}



~~~
`summarise()` ungrouping output (override with `.groups` argument)
~~~
{: .output}



~~~
[90m# A tibble: 12 x 2[39m
    year average
   [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m
[90m 1[39m  [4m1[24m952    49.1
[90m 2[39m  [4m1[24m957    51.5
[90m 3[39m  [4m1[24m962    53.6
[90m 4[39m  [4m1[24m967    55.7
[90m 5[39m  [4m1[24m972    57.6
[90m 6[39m  [4m1[24m977    59.6
[90m 7[39m  [4m1[24m982    61.5
[90m 8[39m  [4m1[24m987    63.2
[90m 9[39m  [4m1[24m992    64.2
[90m10[39m  [4m1[24m997    65.0
[90m11[39m  [4m2[24m002    65.7
[90m12[39m  [4m2[24m007    67.0
~~~
{: .output}
The `group_by()` function just expects you to pass in the name of a column (or mutiple columns separated by commans) in your data.

## TODO: challenge Try calculating the average life expetency by continent

You can also create more than one new column when you call `summarize()`. To do so, you must separate your columns with a comma. Let's calculate the minimum and maximum life expecteny for each year using the `min()` and `max()` functions

~~~
gapminder_data %>%
  group_by(year) %>%
  summarize(min=min(lifeExp), max=max(lifeExp))
~~~
{: .language-r}



~~~
`summarise()` ungrouping output (override with `.groups` argument)
~~~
{: .output}



~~~
[90m# A tibble: 12 x 3[39m
    year   min   max
   [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m
[90m 1[39m  [4m1[24m952  28.8  72.7
[90m 2[39m  [4m1[24m957  30.3  73.5
[90m 3[39m  [4m1[24m962  32.0  73.7
[90m 4[39m  [4m1[24m967  34.0  74.2
[90m 5[39m  [4m1[24m972  35.4  74.7
[90m 6[39m  [4m1[24m977  31.2  76.1
[90m 7[39m  [4m1[24m982  38.4  77.1
[90m 8[39m  [4m1[24m987  39.9  78.7
[90m 9[39m  [4m1[24m992  23.6  79.4
[90m10[39m  [4m1[24m997  36.1  80.7
[90m11[39m  [4m2[24m002  39.2  82  
[90m12[39m  [4m2[24m007  39.6  82.6
~~~
{: .output}
We can now see just how large a gap there is between different countries for the different years.

## Arrange

The `arrange()` function allows us to sort our data by some value. Let's take the average value for each continent in 2007 and then sort it so the continents with the longest life expectencies are on top. What contenent might you guess has be highest life expectency before running the code?

~~~
gapminder_data %>%
  filter(year==2007) %>%
  group_by(continent) %>%
  summarise(average= mean(lifeExp)) %>%
  arrange(desc(average))
~~~
{: .language-r}



~~~
`summarise()` ungrouping output (override with `.groups` argument)
~~~
{: .output}



~~~
[90m# A tibble: 5 x 2[39m
  continent average
  [3m[90m<chr>[39m[23m       [3m[90m<dbl>[39m[23m
[90m1[39m Oceania      80.7
[90m2[39m Europe       77.6
[90m3[39m Americas     73.6
[90m4[39m Asia         70.7
[90m5[39m Africa       54.8
~~~
{: .output}
Notice there that we can use the column created the in the `summarize()` step ("avarage") later in the `arrange()` step. We also use the `desc()` function here to sort the values in a descending order so the largest values are on top. The default is to put the smallest values on top.

## Mutate

Each time we ran `summarize()`, we got back fewer rows than passed in. We either got one row back, or one row per group. But sometimes we want to create a new column in our data without changing the number of rows. The function we use to create new columns is called `mutate()`.

We have a column for the population and the GDP per capita. If we wanted to get the total GDP, we could multiply the per capita GDP values by the total population. Here's what such a `mutate()` command would look like

~~~
gapminder_data %>%
  mutate(gdp = pop * gdpPercap)
~~~
{: .language-r}



~~~
[90m# A tibble: 1,704 x 7[39m
   country      year      pop continent lifeExp gdpPercap          gdp
   [3m[90m<chr>[39m[23m       [3m[90m<dbl>[39m[23m    [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m       [3m[90m<dbl>[39m[23m     [3m[90m<dbl>[39m[23m        [3m[90m<dbl>[39m[23m
[90m 1[39m Afghanistan  [4m1[24m952  8[4m4[24m[4m2[24m[4m5[24m333 Asia         28.8      779.  [4m6[24m567[4m0[24m[4m8[24m[4m6[24m330.
[90m 2[39m Afghanistan  [4m1[24m957  9[4m2[24m[4m4[24m[4m0[24m934 Asia         30.3      821.  [4m7[24m585[4m4[24m[4m4[24m[4m8[24m670.
[90m 3[39m Afghanistan  [4m1[24m962 10[4m2[24m[4m6[24m[4m7[24m083 Asia         32.0      853.  [4m8[24m758[4m8[24m[4m5[24m[4m5[24m797.
[90m 4[39m Afghanistan  [4m1[24m967 11[4m5[24m[4m3[24m[4m7[24m966 Asia         34.0      836.  [4m9[24m648[4m0[24m[4m1[24m[4m4[24m150.
[90m 5[39m Afghanistan  [4m1[24m972 13[4m0[24m[4m7[24m[4m9[24m460 Asia         36.1      740.  [4m9[24m678[4m5[24m[4m5[24m[4m3[24m274.
[90m 6[39m Afghanistan  [4m1[24m977 14[4m8[24m[4m8[24m[4m0[24m372 Asia         38.4      786. [4m1[24m[4m1[24m697[4m6[24m[4m5[24m[4m9[24m231.
[90m 7[39m Afghanistan  [4m1[24m982 12[4m8[24m[4m8[24m[4m1[24m816 Asia         39.9      978. [4m1[24m[4m2[24m598[4m5[24m[4m6[24m[4m3[24m401.
[90m 8[39m Afghanistan  [4m1[24m987 13[4m8[24m[4m6[24m[4m7[24m957 Asia         40.8      852. [4m1[24m[4m1[24m820[4m9[24m[4m9[24m[4m0[24m309.
[90m 9[39m Afghanistan  [4m1[24m992 16[4m3[24m[4m1[24m[4m7[24m921 Asia         41.7      649. [4m1[24m[4m0[24m595[4m9[24m[4m0[24m[4m1[24m589.
[90m10[39m Afghanistan  [4m1[24m997 22[4m2[24m[4m2[24m[4m7[24m415 Asia         41.8      635. [4m1[24m[4m4[24m121[4m9[24m[4m9[24m[4m5[24m875.
[90m# â€¦ with 1,694 more rows[39m
~~~
{: .output}
This will add a new column called "gdp" to our data. We use the column names as if they were regular values that we want to perform mathematical operations on and provide the name infront of an equals sign like we have done with `summarize()`

## Select

We use the `filter()` function to choose a subset of the rows from our data, but when we want to choose a subset of columns from our data we use `select()` . For example, if we only wanted to see the population ("pop") and year values, we can do

~~~
gapminder_data %>%
  select(pop, year)
~~~
{: .language-r}



~~~
[90m# A tibble: 1,704 x 2[39m
        pop  year
      [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m
[90m 1[39m  8[4m4[24m[4m2[24m[4m5[24m333  [4m1[24m952
[90m 2[39m  9[4m2[24m[4m4[24m[4m0[24m934  [4m1[24m957
[90m 3[39m 10[4m2[24m[4m6[24m[4m7[24m083  [4m1[24m962
[90m 4[39m 11[4m5[24m[4m3[24m[4m7[24m966  [4m1[24m967
[90m 5[39m 13[4m0[24m[4m7[24m[4m9[24m460  [4m1[24m972
[90m 6[39m 14[4m8[24m[4m8[24m[4m0[24m372  [4m1[24m977
[90m 7[39m 12[4m8[24m[4m8[24m[4m1[24m816  [4m1[24m982
[90m 8[39m 13[4m8[24m[4m6[24m[4m7[24m957  [4m1[24m987
[90m 9[39m 16[4m3[24m[4m1[24m[4m7[24m921  [4m1[24m992
[90m10[39m 22[4m2[24m[4m2[24m[4m7[24m415  [4m1[24m997
[90m# â€¦ with 1,694 more rows[39m
~~~
{: .output}
The `select()` function has a bunch of helper functions that are handy if you are working with a dataset that has a lot of columns. You can see these helper functions on the `?select` help page. For example, let's say we wanted to select the year column and all the columns that start with the letter "c". You can do that with

~~~
gapminder_data %>%
  select(year, starts_with("c"))
~~~
{: .language-r}



~~~
[90m# A tibble: 1,704 x 3[39m
    year country     continent
   [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m       [3m[90m<chr>[39m[23m    
[90m 1[39m  [4m1[24m952 Afghanistan Asia     
[90m 2[39m  [4m1[24m957 Afghanistan Asia     
[90m 3[39m  [4m1[24m962 Afghanistan Asia     
[90m 4[39m  [4m1[24m967 Afghanistan Asia     
[90m 5[39m  [4m1[24m972 Afghanistan Asia     
[90m 6[39m  [4m1[24m977 Afghanistan Asia     
[90m 7[39m  [4m1[24m982 Afghanistan Asia     
[90m 8[39m  [4m1[24m987 Afghanistan Asia     
[90m 9[39m  [4m1[24m992 Afghanistan Asia     
[90m10[39m  [4m1[24m997 Afghanistan Asia     
[90m# â€¦ with 1,694 more rows[39m
~~~
{: .output}
This returns just the three columns we are interested in. We can also use `select()` to drop/remove particular columns by putting a minus sign (`-`) in front of the column name. For example, if we want everything but the continent column, we can do

~~~
gapminder_data %>%
  select(-continent)
~~~
{: .language-r}



~~~
[90m# A tibble: 1,704 x 5[39m
   country      year      pop lifeExp gdpPercap
   [3m[90m<chr>[39m[23m       [3m[90m<dbl>[39m[23m    [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m     [3m[90m<dbl>[39m[23m
[90m 1[39m Afghanistan  [4m1[24m952  8[4m4[24m[4m2[24m[4m5[24m333    28.8      779.
[90m 2[39m Afghanistan  [4m1[24m957  9[4m2[24m[4m4[24m[4m0[24m934    30.3      821.
[90m 3[39m Afghanistan  [4m1[24m962 10[4m2[24m[4m6[24m[4m7[24m083    32.0      853.
[90m 4[39m Afghanistan  [4m1[24m967 11[4m5[24m[4m3[24m[4m7[24m966    34.0      836.
[90m 5[39m Afghanistan  [4m1[24m972 13[4m0[24m[4m7[24m[4m9[24m460    36.1      740.
[90m 6[39m Afghanistan  [4m1[24m977 14[4m8[24m[4m8[24m[4m0[24m372    38.4      786.
[90m 7[39m Afghanistan  [4m1[24m982 12[4m8[24m[4m8[24m[4m1[24m816    39.9      978.
[90m 8[39m Afghanistan  [4m1[24m987 13[4m8[24m[4m6[24m[4m7[24m957    40.8      852.
[90m 9[39m Afghanistan  [4m1[24m992 16[4m3[24m[4m1[24m[4m7[24m921    41.7      649.
[90m10[39m Afghanistan  [4m1[24m997 22[4m2[24m[4m2[24m[4m7[24m415    41.8      635.
[90m# â€¦ with 1,694 more rows[39m
~~~
{: .output}

## TODO: challenge Find a helper function on the help page that will choose all the columns that have "p" as their last letter (ie: "pop","lifeExp","gdpPerCap")


## Changing the shape of the data

Data comes in many shapes and sizes, and one way we classify data is either "wide" or "long." Data that is "long" has one row per observation. The `gapminder_data` data is in a long format. We have one row for each country for each year and each different measurement for that country is in a different column. We might describe this data as "tidy" because it makes it easy to work with *ggplot2* and *dplyr* functions (this is where the "tidy" in "tidyverse" comes from). But sometimes we may want our data in a "long" format. Typically in "long" format each row represents a group of observations and each value is placed in a different column rather than a different row. For example maybe we want only one row per country and want to spread the life expectendy values into different columns (one for each year).

The *tidyr* package contains the functions `pivot_wider` and `pivot_longer` that make it easy to switch between the two formats. The *tidyr* package is included in the *tidyverse* package so we don't need to do anything to load it.


~~~
gapminder_data %>%
  select(country, continent, year, lifeExp) %>%
  pivot_wider(names_from = year, values_from = lifeExp )
~~~
{: .language-r}



~~~
[90m# A tibble: 142 x 14[39m
   country continent `1952` `1957` `1962` `1967` `1972` `1977` `1982` `1987`
   [3m[90m<chr>[39m[23m   [3m[90m<chr>[39m[23m      [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m
[90m 1[39m Afghanâ€¦ Asia        28.8   30.3   32.0   34.0   36.1   38.4   39.9   40.8
[90m 2[39m Albania Europe      55.2   59.3   64.8   66.2   67.7   68.9   70.4   72  
[90m 3[39m Algeria Africa      43.1   45.7   48.3   51.4   54.5   58.0   61.4   65.8
[90m 4[39m Angola  Africa      30.0   32.0   34     36.0   37.9   39.5   39.9   39.9
[90m 5[39m Argentâ€¦ Americas    62.5   64.4   65.1   65.6   67.1   68.5   69.9   70.8
[90m 6[39m Austraâ€¦ Oceania     69.1   70.3   70.9   71.1   71.9   73.5   74.7   76.3
[90m 7[39m Austria Europe      66.8   67.5   69.5   70.1   70.6   72.2   73.2   74.9
[90m 8[39m Bahrain Asia        50.9   53.8   56.9   59.9   63.3   65.6   69.1   70.8
[90m 9[39m Banglaâ€¦ Asia        37.5   39.3   41.2   43.5   45.3   46.9   50.0   52.8
[90m10[39m Belgium Europe      68     69.2   70.2   70.9   71.4   72.8   73.9   75.4
[90m# â€¦ with 132 more rows, and 4 more variables: `1992` [3m[90m<dbl>[90m[23m, `1997` [3m[90m<dbl>[90m[23m,[39m
[90m#   `2002` [3m[90m<dbl>[90m[23m, `2007` [3m[90m<dbl>[90m[23m[39m
~~~
{: .output}


## Cleaning up data

Challenge: Compare large countries' CO2 emissions relative smaller countries in the Americas?

Problem: We have pouplation data & GDP from gapminder, we also have CO2 from the UN, need to clean, filter, merge, format, etc. Also need to summarize data in a table and/or a plot. We have data in our data directory called co2-un-data.csv.

By double clicking on the file in your Files tab in the lower right panel you can open it in a viewer. This is a real data set that we downloaded from [the UN](https://data.un.org/_Docs/SYB/CSV/SYB63_310_202009_Carbon%20Dioxide%20Emission%20Estimates.csv). Although it may not look like data you use in your research, it has many of the same issues that you will run into with yours. Recall that our goal is to create a data frame that has similar columns to what we generated for the gapminder data so we can directly compare GDP to CO2 emissions. To make this work, we'd like a data frame that contains a column with the country name, and columns for different ways of measuring CO2 emissions. We will also want the data to be collected as close to 2007 (the last year we have data for in gapminder). Let's start with reading the data in using read_csv


~~~
read_csv("data/co2-un-data.csv")
~~~
{: .language-r}



~~~
Warning: Missing column names filled in: 'X3' [3], 'X4' [4], 'X5' [5], 'X6' [6],
'X7' [7]
~~~
{: .warning}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  T24 = [31mcol_character()[39m,
  `CO2 emission estimates` = [31mcol_character()[39m,
  X3 = [31mcol_character()[39m,
  X4 = [31mcol_character()[39m,
  X5 = [31mcol_character()[39m,
  X6 = [31mcol_character()[39m,
  X7 = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 2,133 x 7[39m
   T24      `CO2 emission estâ€¦ X3    X4            X5    X6    X7               
   [3m[90m<chr>[39m[23m    [3m[90m<chr>[39m[23m              [3m[90m<chr>[39m[23m [3m[90m<chr>[39m[23m         [3m[90m<chr>[39m[23m [3m[90m<chr>[39m[23m [3m[90m<chr>[39m[23m            
[90m 1[39m Region/â€¦ [31mNA[39m                 Year  Series        Value Footâ€¦ Source           
[90m 2[39m 8        Albania            1975  Emissions (tâ€¦ 4338â€¦ [31mNA[39m    International Enâ€¦
[90m 3[39m 8        Albania            1985  Emissions (tâ€¦ 6929â€¦ [31mNA[39m    International Enâ€¦
[90m 4[39m 8        Albania            1995  Emissions (tâ€¦ 1848â€¦ [31mNA[39m    International Enâ€¦
[90m 5[39m 8        Albania            2005  Emissions (tâ€¦ 3825â€¦ [31mNA[39m    International Enâ€¦
[90m 6[39m 8        Albania            2010  Emissions (tâ€¦ 3930â€¦ [31mNA[39m    International Enâ€¦
[90m 7[39m 8        Albania            2015  Emissions (tâ€¦ 3824â€¦ [31mNA[39m    International Enâ€¦
[90m 8[39m 8        Albania            2016  Emissions (tâ€¦ 3674â€¦ [31mNA[39m    International Enâ€¦
[90m 9[39m 8        Albania            2017  Emissions (tâ€¦ 4342â€¦ [31mNA[39m    International Enâ€¦
[90m10[39m 8        Albania            1975  Emissions peâ€¦ 1.80â€¦ [31mNA[39m    International Enâ€¦
[90m# â€¦ with 2,123 more rows[39m
~~~
{: .output}

The output gives us a warning about missing column names being filled in with things like 'X3', 'X4', etc. Looking at the table that is outputted by `read_csv` we can see that there appear to be two rows at the top of the file that contain information about the data in the table. The first is a header that tells us the table number and its name. Ideally, we'd skip that. We can do this using the `skip` argument in read_csv by giving it a number of lines to skip.


~~~
read_csv("data/co2-un-data.csv", skip=1)
~~~
{: .language-r}



~~~
Warning: Missing column names filled in: 'X2' [2]
~~~
{: .warning}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  `Region/Country/Area` = [32mcol_double()[39m,
  X2 = [31mcol_character()[39m,
  Year = [32mcol_double()[39m,
  Series = [31mcol_character()[39m,
  Value = [32mcol_double()[39m,
  Footnotes = [31mcol_character()[39m,
  Source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 2,132 x 7[39m
   `Region/Country/â€¦ X2      Year Series        Value Footnotes Source          
               [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m  [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m         [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m     [3m[90m<chr>[39m[23m           
[90m 1[39m                 8 Albanâ€¦  [4m1[24m975 Emissions (â€¦ 4.34[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 2[39m                 8 Albanâ€¦  [4m1[24m985 Emissions (â€¦ 6.93[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 3[39m                 8 Albanâ€¦  [4m1[24m995 Emissions (â€¦ 1.85[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 4[39m                 8 Albanâ€¦  [4m2[24m005 Emissions (â€¦ 3.83[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 5[39m                 8 Albanâ€¦  [4m2[24m010 Emissions (â€¦ 3.93[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 6[39m                 8 Albanâ€¦  [4m2[24m015 Emissions (â€¦ 3.82[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 7[39m                 8 Albanâ€¦  [4m2[24m016 Emissions (â€¦ 3.67[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 8[39m                 8 Albanâ€¦  [4m2[24m017 Emissions (â€¦ 4.34[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 9[39m                 8 Albanâ€¦  [4m1[24m975 Emissions pâ€¦ 1.80[90me[39m0 [31mNA[39m        International Eâ€¦
[90m10[39m                 8 Albanâ€¦  [4m1[24m985 Emissions pâ€¦ 2.34[90me[39m0 [31mNA[39m        International Eâ€¦
[90m# â€¦ with 2,122 more rows[39m
~~~
{: .output}

Now we get a similar Warning message as before, but the outputted table looks better. It's important to differentiate between Warnings and Errors in R. A warning tells us, "you might want to know about this issue, but R still did what you asked". An error tells us, "there's something wrong with your code or your data and R didn't do what you asked". You need to fix any errors that arise. Warnings, are probably best to resolve or at least understand why they are coming up. We can resolve this warning by one of two methods. First, we can tell read_csv what the column names should be with the col_names argument where we give it the column names we want within the c() function separated by commas. If we do this, then we need to set skip to 2 to also skip the column headings


~~~
read_csv("data/co2-un-data.csv", skip=2,
col_names=c("region", "country", "year", "series", "value", "footnotes", "source"))
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  region = [32mcol_double()[39m,
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  series = [31mcol_character()[39m,
  value = [32mcol_double()[39m,
  footnotes = [31mcol_character()[39m,
  source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 2,132 x 7[39m
   region country  year series             value footnotes source               
    [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m   [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m              [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m     [3m[90m<chr>[39m[23m                
[90m 1[39m      8 Albania  [4m1[24m975 Emissions (thousâ€¦ 4.34[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 2[39m      8 Albania  [4m1[24m985 Emissions (thousâ€¦ 6.93[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 3[39m      8 Albania  [4m1[24m995 Emissions (thousâ€¦ 1.85[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 4[39m      8 Albania  [4m2[24m005 Emissions (thousâ€¦ 3.83[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 5[39m      8 Albania  [4m2[24m010 Emissions (thousâ€¦ 3.93[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 6[39m      8 Albania  [4m2[24m015 Emissions (thousâ€¦ 3.82[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 7[39m      8 Albania  [4m2[24m016 Emissions (thousâ€¦ 3.67[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 8[39m      8 Albania  [4m2[24m017 Emissions (thousâ€¦ 4.34[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 9[39m      8 Albania  [4m1[24m975 Emissions per caâ€¦ 1.80[90me[39m0 [31mNA[39m        International Energyâ€¦
[90m10[39m      8 Albania  [4m1[24m985 Emissions per caâ€¦ 2.34[90me[39m0 [31mNA[39m        International Energyâ€¦
[90m# â€¦ with 2,122 more rows[39m
~~~
{: .output}

As an alternative, we can read in the table, get the warning and then fix the column names using the rename function.


~~~
read_csv("data/co2-un-data.csv", skip=1) %>%
rename(country=X2)
~~~
{: .language-r}



~~~
Warning: Missing column names filled in: 'X2' [2]
~~~
{: .warning}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  `Region/Country/Area` = [32mcol_double()[39m,
  X2 = [31mcol_character()[39m,
  Year = [32mcol_double()[39m,
  Series = [31mcol_character()[39m,
  Value = [32mcol_double()[39m,
  Footnotes = [31mcol_character()[39m,
  Source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 2,132 x 7[39m
   `Region/Country/â€¦ country  Year Series        Value Footnotes Source         
               [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m   [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m         [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m     [3m[90m<chr>[39m[23m          
[90m 1[39m                 8 Albania  [4m1[24m975 Emissions (â€¦ 4.34[90me[39m3 [31mNA[39m        International â€¦
[90m 2[39m                 8 Albania  [4m1[24m985 Emissions (â€¦ 6.93[90me[39m3 [31mNA[39m        International â€¦
[90m 3[39m                 8 Albania  [4m1[24m995 Emissions (â€¦ 1.85[90me[39m3 [31mNA[39m        International â€¦
[90m 4[39m                 8 Albania  [4m2[24m005 Emissions (â€¦ 3.83[90me[39m3 [31mNA[39m        International â€¦
[90m 5[39m                 8 Albania  [4m2[24m010 Emissions (â€¦ 3.93[90me[39m3 [31mNA[39m        International â€¦
[90m 6[39m                 8 Albania  [4m2[24m015 Emissions (â€¦ 3.82[90me[39m3 [31mNA[39m        International â€¦
[90m 7[39m                 8 Albania  [4m2[24m016 Emissions (â€¦ 3.67[90me[39m3 [31mNA[39m        International â€¦
[90m 8[39m                 8 Albania  [4m2[24m017 Emissions (â€¦ 4.34[90me[39m3 [31mNA[39m        International â€¦
[90m 9[39m                 8 Albania  [4m1[24m975 Emissions pâ€¦ 1.80[90me[39m0 [31mNA[39m        International â€¦
[90m10[39m                 8 Albania  [4m1[24m985 Emissions pâ€¦ 2.34[90me[39m0 [31mNA[39m        International â€¦
[90m# â€¦ with 2,122 more rows[39m
~~~
{: .output}

A lot of data analysts prefer to have their column headings and variable names be in all lower case. We can use a variation of `rename`, which is `rename_all` that allows us to set all of the column headings to lower case by giving it the name of the tolower function, which makes everything lowercase.


~~~
read_csv("data/co2-un-data.csv", skip=1) %>%
rename_all(tolower)
~~~
{: .language-r}



~~~
Warning: Missing column names filled in: 'X2' [2]
~~~
{: .warning}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  `Region/Country/Area` = [32mcol_double()[39m,
  X2 = [31mcol_character()[39m,
  Year = [32mcol_double()[39m,
  Series = [31mcol_character()[39m,
  Value = [32mcol_double()[39m,
  Footnotes = [31mcol_character()[39m,
  Source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 2,132 x 7[39m
   `region/country/â€¦ x2      year series        value footnotes source          
               [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m  [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m         [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m     [3m[90m<chr>[39m[23m           
[90m 1[39m                 8 Albanâ€¦  [4m1[24m975 Emissions (â€¦ 4.34[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 2[39m                 8 Albanâ€¦  [4m1[24m985 Emissions (â€¦ 6.93[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 3[39m                 8 Albanâ€¦  [4m1[24m995 Emissions (â€¦ 1.85[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 4[39m                 8 Albanâ€¦  [4m2[24m005 Emissions (â€¦ 3.83[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 5[39m                 8 Albanâ€¦  [4m2[24m010 Emissions (â€¦ 3.93[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 6[39m                 8 Albanâ€¦  [4m2[24m015 Emissions (â€¦ 3.82[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 7[39m                 8 Albanâ€¦  [4m2[24m016 Emissions (â€¦ 3.67[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 8[39m                 8 Albanâ€¦  [4m2[24m017 Emissions (â€¦ 4.34[90me[39m3 [31mNA[39m        International Eâ€¦
[90m 9[39m                 8 Albanâ€¦  [4m1[24m975 Emissions pâ€¦ 1.80[90me[39m0 [31mNA[39m        International Eâ€¦
[90m10[39m                 8 Albanâ€¦  [4m1[24m985 Emissions pâ€¦ 2.34[90me[39m0 [31mNA[39m        International Eâ€¦
[90m# â€¦ with 2,122 more rows[39m
~~~
{: .output}

Both of these strategies are useful for helping us to clean up our data. Which you ultimately use for this project is a matter of personal preference. We'll go with the first option where we used col_names so that we don't have to worry about the Warning message.


~~~
read_csv("data/co2-un-data.csv", skip=2,
col_names=c("region", "country", "year", "series", "value", "footnotes", "source"))
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  region = [32mcol_double()[39m,
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  series = [31mcol_character()[39m,
  value = [32mcol_double()[39m,
  footnotes = [31mcol_character()[39m,
  source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 2,132 x 7[39m
   region country  year series             value footnotes source               
    [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m   [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m              [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m     [3m[90m<chr>[39m[23m                
[90m 1[39m      8 Albania  [4m1[24m975 Emissions (thousâ€¦ 4.34[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 2[39m      8 Albania  [4m1[24m985 Emissions (thousâ€¦ 6.93[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 3[39m      8 Albania  [4m1[24m995 Emissions (thousâ€¦ 1.85[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 4[39m      8 Albania  [4m2[24m005 Emissions (thousâ€¦ 3.83[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 5[39m      8 Albania  [4m2[24m010 Emissions (thousâ€¦ 3.93[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 6[39m      8 Albania  [4m2[24m015 Emissions (thousâ€¦ 3.82[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 7[39m      8 Albania  [4m2[24m016 Emissions (thousâ€¦ 3.67[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 8[39m      8 Albania  [4m2[24m017 Emissions (thousâ€¦ 4.34[90me[39m3 [31mNA[39m        International Energyâ€¦
[90m 9[39m      8 Albania  [4m1[24m975 Emissions per caâ€¦ 1.80[90me[39m0 [31mNA[39m        International Energyâ€¦
[90m10[39m      8 Albania  [4m1[24m985 Emissions per caâ€¦ 2.34[90me[39m0 [31mNA[39m        International Energyâ€¦
[90m# â€¦ with 2,122 more rows[39m
~~~
{: .output}

We previously saw how we can subset columns from a data frame using the select function. Let's get the country, year, series, and value columns


~~~
read_csv("data/co2-un-data.csv", skip=2,
col_names=c("region", "country", "year", "series", "value", "footnotes", "source")) %>%
select(country, year, series, value)
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  region = [32mcol_double()[39m,
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  series = [31mcol_character()[39m,
  value = [32mcol_double()[39m,
  footnotes = [31mcol_character()[39m,
  source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 2,132 x 4[39m
   country  year series                                                 value
   [3m[90m<chr>[39m[23m   [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m                                                  [3m[90m<dbl>[39m[23m
[90m 1[39m Albania  [4m1[24m975 Emissions (thousand metric tons of carbon dioxide)   [4m4[24m338.  
[90m 2[39m Albania  [4m1[24m985 Emissions (thousand metric tons of carbon dioxide)   [4m6[24m930.  
[90m 3[39m Albania  [4m1[24m995 Emissions (thousand metric tons of carbon dioxide)   [4m1[24m849.  
[90m 4[39m Albania  [4m2[24m005 Emissions (thousand metric tons of carbon dioxide)   [4m3[24m825.  
[90m 5[39m Albania  [4m2[24m010 Emissions (thousand metric tons of carbon dioxide)   [4m3[24m930.  
[90m 6[39m Albania  [4m2[24m015 Emissions (thousand metric tons of carbon dioxide)   [4m3[24m825.  
[90m 7[39m Albania  [4m2[24m016 Emissions (thousand metric tons of carbon dioxide)   [4m3[24m674.  
[90m 8[39m Albania  [4m2[24m017 Emissions (thousand metric tons of carbon dioxide)   [4m4[24m342.  
[90m 9[39m Albania  [4m1[24m975 Emissions per capita (metric tons of carbon dioxide)    1.80
[90m10[39m Albania  [4m1[24m985 Emissions per capita (metric tons of carbon dioxide)    2.34
[90m# â€¦ with 2,122 more rows[39m
~~~
{: .output}

The series column has two methods of quantifying CO2 emissions - "Emissions (thousand metric tons of carbon dioxide)" and "Emissions per capita (metric tons of carbon dioxide)". Those are long titles that we'd like to shorten to make them easier to work with. We can shorten them to "total" and "per_capita" using the recode function. We need to do this within the mutate function where we will mutate the series column. The syntax in the recode function is to tell recode which column we want to recode and then what the old value (e.g. "Emissions (thousand metric tons of carbon dioxide)") should equal after recoding (e.g. "total").


~~~
read_csv("data/co2-un-data.csv", skip=2,
col_names=c("region", "country", "year", "series", "value", "footnotes", "source")) %>%
select(country, year, series, value) %>%
mutate(series = recode(series, "Emissions (thousand metric tons of carbon dioxide)" = "total",
"Emissions per capita (metric tons of carbon dioxide)" = "per_capita"))
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  region = [32mcol_double()[39m,
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  series = [31mcol_character()[39m,
  value = [32mcol_double()[39m,
  footnotes = [31mcol_character()[39m,
  source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 2,132 x 4[39m
   country  year series       value
   [3m[90m<chr>[39m[23m   [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m        [3m[90m<dbl>[39m[23m
[90m 1[39m Albania  [4m1[24m975 total      [4m4[24m338.  
[90m 2[39m Albania  [4m1[24m985 total      [4m6[24m930.  
[90m 3[39m Albania  [4m1[24m995 total      [4m1[24m849.  
[90m 4[39m Albania  [4m2[24m005 total      [4m3[24m825.  
[90m 5[39m Albania  [4m2[24m010 total      [4m3[24m930.  
[90m 6[39m Albania  [4m2[24m015 total      [4m3[24m825.  
[90m 7[39m Albania  [4m2[24m016 total      [4m3[24m674.  
[90m 8[39m Albania  [4m2[24m017 total      [4m4[24m342.  
[90m 9[39m Albania  [4m1[24m975 per_capita    1.80
[90m10[39m Albania  [4m1[24m985 per_capita    2.34
[90m# â€¦ with 2,122 more rows[39m
~~~
{: .output}

Recall that we'd like to have separate columns for the two ways that we CO2 emissions data. To achieve this, we'll use the pivot_wider function that we saw previously. The columns we want to spread out are series (i.e. names_from) and value (i.e. values_from).


~~~
read_csv("data/co2-un-data.csv", skip=2,
col_names=c("region", "country", "year", "series", "value", "footnotes", "source")) %>%
select(country, year, series, value) %>%
mutate(series = recode(series, "Emissions (thousand metric tons of carbon dioxide)" = "total",
"Emissions per capita (metric tons of carbon dioxide)" = "per_capita")) %>%
pivot_wider(names_from=series, values_from=value)
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  region = [32mcol_double()[39m,
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  series = [31mcol_character()[39m,
  value = [32mcol_double()[39m,
  footnotes = [31mcol_character()[39m,
  source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 1,066 x 4[39m
   country  year  total per_capita
   [3m[90m<chr>[39m[23m   [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m      [3m[90m<dbl>[39m[23m
[90m 1[39m Albania  [4m1[24m975  [4m4[24m338.      1.80 
[90m 2[39m Albania  [4m1[24m985  [4m6[24m930.      2.34 
[90m 3[39m Albania  [4m1[24m995  [4m1[24m849.      0.580
[90m 4[39m Albania  [4m2[24m005  [4m3[24m825.      1.27 
[90m 5[39m Albania  [4m2[24m010  [4m3[24m930.      1.35 
[90m 6[39m Albania  [4m2[24m015  [4m3[24m825.      1.33 
[90m 7[39m Albania  [4m2[24m016  [4m3[24m674.      1.28 
[90m 8[39m Albania  [4m2[24m017  [4m4[24m342.      1.51 
[90m 9[39m Algeria  [4m1[24m975 [4m1[24m[4m3[24m553.      0.811
[90m10[39m Algeria  [4m1[24m985 [4m4[24m[4m2[24m073.      1.86 
[90m# â€¦ with 1,056 more rows[39m
~~~
{: .output}

Excellent! The last step before we can join this data frame is to get the most data that is for the year closest to 2007 so we can make a more direct comparison to the most recent data we have from gapminder. One useful tool is the count function, which will tell us how many times a value is repeated in a column of a data frame. Let's us that on the year column to see which years we have data for and to tell us whether we have a good number of countries represented in that year


~~~
read_csv("data/co2-un-data.csv", skip=2,
col_names=c("region", "country", "year", "series", "value", "footnotes", "source")) %>%
select(country, year, series, value) %>%
mutate(series = recode(series, "Emissions (thousand metric tons of carbon dioxide)" = "total",
"Emissions per capita (metric tons of carbon dioxide)" = "per_capita")) %>%
pivot_wider(names_from=series, values_from=value) %>%
count(year)
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  region = [32mcol_double()[39m,
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  series = [31mcol_character()[39m,
  value = [32mcol_double()[39m,
  footnotes = [31mcol_character()[39m,
  source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 8 x 2[39m
   year     n
  [3m[90m<dbl>[39m[23m [3m[90m<int>[39m[23m
[90m1[39m  [4m1[24m975   111
[90m2[39m  [4m1[24m985   113
[90m3[39m  [4m1[24m995   136
[90m4[39m  [4m2[24m005   140
[90m5[39m  [4m2[24m010   140
[90m6[39m  [4m2[24m015   142
[90m7[39m  [4m2[24m016   142
[90m8[39m  [4m2[24m017   142
~~~
{: .output}

It looks like we have data for 140 countries in 2005 and 2010. Let's filter our data to get the rows that correspond to 2005. Also, because we will only have data from one year, we can drop the year column from our data frame by giving it year with a minus sign before it.


~~~
read_csv("data/co2-un-data.csv", skip=2,
col_names=c("region", "country", "year", "series", "value", "footnotes", "source")) %>%
select(country, year, series, value) %>%
mutate(series = recode(series, "Emissions (thousand metric tons of carbon dioxide)" = "total",
"Emissions per capita (metric tons of carbon dioxide)" = "per_capita")) %>%
pivot_wider(names_from=series, values_from=value) %>%
filter(year==2005) %>%
select(-year)
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  region = [32mcol_double()[39m,
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  series = [31mcol_character()[39m,
  value = [32mcol_double()[39m,
  footnotes = [31mcol_character()[39m,
  source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
[90m# A tibble: 140 x 3[39m
   country      total per_capita
   [3m[90m<chr>[39m[23m        [3m[90m<dbl>[39m[23m      [3m[90m<dbl>[39m[23m
[90m 1[39m Albania      [4m3[24m825.      1.27 
[90m 2[39m Algeria     [4m7[24m[4m7[24m474.      2.33 
[90m 3[39m Angola       [4m6[24m147.      0.314
[90m 4[39m Argentina  [4m1[24m[4m4[24m[4m9[24m476.      3.82 
[90m 5[39m Armenia      [4m4[24m130.      1.38 
[90m 6[39m Australia  [4m3[24m[4m6[24m[4m5[24m515.     17.9  
[90m 7[39m Austria     [4m7[24m[4m4[24m764.      9.09 
[90m 8[39m Azerbaijan  [4m2[24m[4m9[24m018.      3.46 
[90m 9[39m Bahrain     [4m2[24m[4m0[24m565.     23.1  
[90m10[39m Bangladesh  [4m3[24m[4m1[24m960.      0.223
[90m# â€¦ with 130 more rows[39m
~~~
{: .output}

Finally, let's go ahead and assign the output of this code chunk to a variable name


~~~
co2_emissions <- read_csv("data/co2-un-data.csv", skip=2,
col_names=c("region", "country", "year", "series", "value", "footnotes", "source")) %>%
select(country, year, series, value) %>%
mutate(series = recode(series, "Emissions (thousand metric tons of carbon dioxide)" = "total",
"Emissions per capita (metric tons of carbon dioxide)" = "per_capita")) %>%
pivot_wider(names_from=series, values_from=value) %>%
filter(year==2005) %>%
select(-year)
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  region = [32mcol_double()[39m,
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  series = [31mcol_character()[39m,
  value = [32mcol_double()[39m,
  footnotes = [31mcol_character()[39m,
  source = [31mcol_character()[39m
)
~~~
{: .output}


## Joining data frames

Now we're ready to join our CO2 emissions data to the gapminder data. Previously we saw that we could reaad in and filter the gapminder data like this to get the data from the Americas for 2007:


~~~
gapminder_data <- read_csv("data/gapminder_data.csv") %>%
  filter(year == 2007 & continent == "Americas") %>%
  select(-year, -continent)
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  pop = [32mcol_double()[39m,
  continent = [31mcol_character()[39m,
  lifeExp = [32mcol_double()[39m,
  gdpPercap = [32mcol_double()[39m
)
~~~
{: .output}

Look at the data in co2_emissions and gapminder_data. If you had to merge these two data frames together, which column would you use to merge them together? If you said "country" - good job! We'll call country our "key". Now, when we join them together, can you think of any problems we might run into when we merge things? We might not have CO2 emissions data for all of the countries in the gapmiinder dataset and vice versa. Also, a country might be represented in both data frames but by the same name in both places. As an example, write down the name of the country that the University of Michigan is in. Remember your answer and we'll come back to you answer shortly!

The dplyr package has a number of tools for joining data frames together depending on what we want to do with the rows of the data of countries that are not represented in both data frames. Let's look at some cartoon examples and then come back to our own data.

The first join we'll discuss is achieved using `inner_join`. In an inner join, the new data frame only has those rows where the same key is found in both data frames. This is a very commonly used join.

![](04-r-data-analysis-assets/join-inner.png)

The second group of joins are called outer joins and can be peformed using `left_join`, `right_join`, and `full_join`. In a left join, if the key is present in the left hand data frame, it will appear in the output, even if it is not found in the the right hand data frame. For a right join, the opposite is true. For a full join, all possible keys are included in the outputted data frame

![](04-r-data-analysis-assets/join-outer.png)

For our data, which join do you think we'd want to use? Most likely, we'd like to use `inner_join` or a `left_join` where the gapminder data frame is on the left and the CO2 emissions data frame is on the right. The advantage of these joins over the others is that because our gapminder data is filtered only to represent the Americas, then only the countries from the Americas will be represented in the CO2 emissions data. Let's try using the inner_join function


~~~
inner_join(gapminder_data, co2_emissions)
~~~
{: .language-r}



~~~
Joining, by = "country"
~~~
{: .output}



~~~
[90m# A tibble: 21 x 6[39m
   country                  pop lifeExp gdpPercap   total per_capita
   [3m[90m<chr>[39m[23m                  [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m     [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m      [3m[90m<dbl>[39m[23m
[90m 1[39m Argentina           40[4m3[24m[4m0[24m[4m1[24m927    75.3    [4m1[24m[4m2[24m779. [4m1[24m[4m4[24m[4m9[24m476.       3.82
[90m 2[39m Brazil             190[4m0[24m[4m1[24m[4m0[24m647    72.4     [4m9[24m066. [4m3[24m[4m1[24m[4m1[24m624.       1.67
[90m 3[39m Canada              33[4m3[24m[4m9[24m[4m0[24m141    80.7    [4m3[24m[4m6[24m319. [4m5[24m[4m4[24m[4m0[24m431.      16.8 
[90m 4[39m Chile               16[4m2[24m[4m8[24m[4m4[24m741    78.6    [4m1[24m[4m3[24m172.  [4m5[24m[4m4[24m435.       3.34
[90m 5[39m Colombia            44[4m2[24m[4m2[24m[4m7[24m550    72.9     [4m7[24m007.  [4m5[24m[4m3[24m585.       1.24
[90m 6[39m Costa Rica           4[4m1[24m[4m3[24m[4m3[24m884    78.8     [4m9[24m645.   [4m5[24m463.       1.29
[90m 7[39m Cuba                11[4m4[24m[4m1[24m[4m6[24m987    78.3     [4m8[24m948.  [4m2[24m[4m5[24m051.       2.22
[90m 8[39m Dominican Republic   9[4m3[24m[4m1[24m[4m9[24m622    72.2     [4m6[24m025.  [4m1[24m[4m7[24m522.       1.90
[90m 9[39m Ecuador             13[4m7[24m[4m5[24m[4m5[24m680    75.0     [4m6[24m873.  [4m2[24m[4m3[24m927.       1.74
[90m10[39m El Salvador          6[4m9[24m[4m3[24m[4m9[24m688    71.9     [4m5[24m728.   [4m6[24m253.       1.04
[90m# â€¦ with 11 more rows[39m
~~~
{: .output}

Do you see that we now have data from both data frames joined together in the same data frame? One thing to note about the output is that `inner_join` tells us that that it joined by "country". We can make this explicit using the "by" argument in the join functions


~~~
inner_join(gapminder_data, co2_emissions, by="country")
~~~
{: .language-r}



~~~
[90m# A tibble: 21 x 6[39m
   country                  pop lifeExp gdpPercap   total per_capita
   [3m[90m<chr>[39m[23m                  [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m     [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m      [3m[90m<dbl>[39m[23m
[90m 1[39m Argentina           40[4m3[24m[4m0[24m[4m1[24m927    75.3    [4m1[24m[4m2[24m779. [4m1[24m[4m4[24m[4m9[24m476.       3.82
[90m 2[39m Brazil             190[4m0[24m[4m1[24m[4m0[24m647    72.4     [4m9[24m066. [4m3[24m[4m1[24m[4m1[24m624.       1.67
[90m 3[39m Canada              33[4m3[24m[4m9[24m[4m0[24m141    80.7    [4m3[24m[4m6[24m319. [4m5[24m[4m4[24m[4m0[24m431.      16.8 
[90m 4[39m Chile               16[4m2[24m[4m8[24m[4m4[24m741    78.6    [4m1[24m[4m3[24m172.  [4m5[24m[4m4[24m435.       3.34
[90m 5[39m Colombia            44[4m2[24m[4m2[24m[4m7[24m550    72.9     [4m7[24m007.  [4m5[24m[4m3[24m585.       1.24
[90m 6[39m Costa Rica           4[4m1[24m[4m3[24m[4m3[24m884    78.8     [4m9[24m645.   [4m5[24m463.       1.29
[90m 7[39m Cuba                11[4m4[24m[4m1[24m[4m6[24m987    78.3     [4m8[24m948.  [4m2[24m[4m5[24m051.       2.22
[90m 8[39m Dominican Republic   9[4m3[24m[4m1[24m[4m9[24m622    72.2     [4m6[24m025.  [4m1[24m[4m7[24m522.       1.90
[90m 9[39m Ecuador             13[4m7[24m[4m5[24m[4m5[24m680    75.0     [4m6[24m873.  [4m2[24m[4m3[24m927.       1.74
[90m10[39m El Salvador          6[4m9[24m[4m3[24m[4m9[24m688    71.9     [4m5[24m728.   [4m6[24m253.       1.04
[90m# â€¦ with 11 more rows[39m
~~~
{: .output}

One thing to notice is that `co2_emissions` had 25 rows, but the output of our join only had 21. Let's investigate. It appears that there must have been countries in the gapminder data that did not appear in our co2_emissions data frame. We could look at which countries are missing using `left_join` and piping the output to `View()`


~~~
left_join(gapminder_data, co2_emissions, by="country") %>%
View()
~~~
{: .language-r}



~~~
Warning in View(.): unable to open display
~~~
{: .warning}



~~~
Error in .External2(C_dataviewer, x, title): unable to start data viewer
~~~
{: .error}

We can see that the co2_emissions data were missing for Bolivia, Puerto Rico, United States, and Venezuela. Another way to get the same information a bit more directly is to use an `anti_join`.  This will show us the data for the keys on the left that are missing from the data frame on the right


~~~
anti_join(gapminder_data, co2_emissions, by="country")
~~~
{: .language-r}



~~~
[90m# A tibble: 4 x 4[39m
  country             pop lifeExp gdpPercap
  [3m[90m<chr>[39m[23m             [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m     [3m[90m<dbl>[39m[23m
[90m1[39m Bolivia         9[4m1[24m[4m1[24m[4m9[24m152    65.6     [4m3[24m822.
[90m2[39m Puerto Rico     3[4m9[24m[4m4[24m[4m2[24m491    78.7    [4m1[24m[4m9[24m329.
[90m3[39m United States 301[4m1[24m[4m3[24m[4m9[24m947    78.2    [4m4[24m[4m2[24m952.
[90m4[39m Venezuela      26[4m0[24m[4m8[24m[4m4[24m662    73.7    [4m1[24m[4m1[24m416.
~~~
{: .output}

If we look at the co2_emissions data with `View()`, we will see that Bolivia, United States, and Venezuela are called different things in the co2_emissions data frame. They're called "Bolivia (Plurin. State of)", "United States of America", and "Venezuela (Boliv. Rep. of)". Puerto Rico isn't a country; it's part of the United States. To fix this, we can use the `recode` functions like we did earlier when altering the values of the "series" column.


~~~
co2_emissions <- read_csv("data/co2-un-data.csv", skip=2,
col_names=c("region", "country", "year", "series", "value", "footnotes", "source")) %>%
select(country, year, series, value) %>%
mutate(series = recode(series, "Emissions (thousand metric tons of carbon dioxide)" = "total",
"Emissions per capita (metric tons of carbon dioxide)" = "per_capita")) %>%
pivot_wider(names_from=series, values_from=value) %>%
filter(year==2005) %>%
select(-year) %>%
mutate(country=recode(country,
 "Bolivia (Plurin. State of)" = "Bolivia",
"United States of America" = "United States",
"Venezuela (Boliv. Rep. of)" = "Venezuela")
)
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  region = [32mcol_double()[39m,
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  series = [31mcol_character()[39m,
  value = [32mcol_double()[39m,
  footnotes = [31mcol_character()[39m,
  source = [31mcol_character()[39m
)
~~~
{: .output}



~~~
anti_join(gapminder_data, co2_emissions, by="country")
~~~
{: .language-r}



~~~
[90m# A tibble: 1 x 4[39m
  country         pop lifeExp gdpPercap
  [3m[90m<chr>[39m[23m         [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m     [3m[90m<dbl>[39m[23m
[90m1[39m Puerto Rico 3[4m9[24m[4m4[24m[4m2[24m491    78.7    [4m1[24m[4m9[24m329.
~~~
{: .output}

[[ NOTE: This could easily be pulled out as an exercise ]]
This leaves us with a missing row for Puerto Rico. We could ignore this and move on or we could add it's values to those of the United States. Let's recode Puerto Rico as United States and then use `group_by` and `summarize` to aggregate the data; we'll use the population data to weight the life expectancy and GDP values.


~~~
gapminder_data <- read_csv("data/gapminder_data.csv") %>%
  filter(year == 2007 & continent == "Americas") %>%
  select(-year, -continent) %>%
  mutate(country = recode(country, "Puerto Rico" = "United States")) %>%
  group_by(country) %>%
  summarize(lifeExp = sum(lifeExp * pop)/sum(pop),
gdpPercap = sum(gdpPercap * pop)/sum(pop),
pop = sum(pop)
  )
~~~
{: .language-r}



~~~

[36mâ”€â”€[39m [1m[1mColumn specification[1m[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
cols(
  country = [31mcol_character()[39m,
  year = [32mcol_double()[39m,
  pop = [32mcol_double()[39m,
  continent = [31mcol_character()[39m,
  lifeExp = [32mcol_double()[39m,
  gdpPercap = [32mcol_double()[39m
)
~~~
{: .output}



~~~
`summarise()` ungrouping output (override with `.groups` argument)
~~~
{: .output}



~~~
anti_join(gapminder_data, co2_emissions, by="country")
~~~
{: .language-r}



~~~
[90m# A tibble: 0 x 4[39m
[90m# â€¦ with 4 variables: country [3m[90m<chr>[90m[23m, lifeExp [3m[90m<dbl>[90m[23m, gdpPercap [3m[90m<dbl>[90m[23m, pop [3m[90m<dbl>[90m[23m[39m
~~~
{: .output}

Now our `anti_join` returns an empty data frame, which tells us that we have reconciled all of the keys from the gapminder data with the data in the co2_emissions data frame.

[[ END OF NOTE ]]

Let's use the `inner_join` to create a new data frame


~~~
gapminder_co2 <- inner_join(gapminder_data, co2_emissions, by="country")
~~~
{: .language-r}


## Analyzing combined data

We have two questions we'd like to answer. First, is there a relationship between the GDP of a country and the amount of CO2 emiited (per capita)? Second, Canada, the United States, and Mexico account for nearly half of the population of the Americas. What pecent of the total CO2 production do they account for?

To answer the first question, we'll plot the CO2 emitted (on a per capita basis) against the GDP (on a per capita basis) using a scatter plot


~~~
ggplot(gapminder_co2, aes(x=gdpPercap, y=per_capita)) +
geom_point() +
labs(x="GDP (per capita)",
y="CO2 emitted (per capita)",
title="There is a strong association between a nation's GDP and the amount of CO2 it produces"
)
~~~
{: .language-r}

<img src="../fig/rmd-01-unnamed-chunk-23-1.png" title="plot of chunk unnamed-chunk-23" alt="plot of chunk unnamed-chunk-23" width="612" style="display: block; margin: auto;" />

To help clarify the association, we can add a fit line through the data using `geom_smooth`


~~~
ggplot(gapminder_co2, aes(x=gdpPercap, y=per_capita)) +
geom_point() +
labs(x="GDP (per capita)",
y="CO2 emitted (per capita)",
title="There is a strong association between a nation's GDP and the amount of CO2 it produces"
) +
geom_smooth()
~~~
{: .language-r}



~~~
`geom_smooth()` using method = 'loess' and formula 'y ~ x'
~~~
{: .output}

<img src="../fig/rmd-01-unnamed-chunk-24-1.png" title="plot of chunk unnamed-chunk-24" alt="plot of chunk unnamed-chunk-24" width="612" style="display: block; margin: auto;" />

We can force the line to be straight using `method="lm"` as an argument to `geom_smooth`


~~~
ggplot(gapminder_co2, aes(x=gdpPercap, y=per_capita)) +
geom_point() +
labs(x="GDP (per capita)",
y="CO2 emitted (per capita)",
title="There is a strong association between a nation's GDP and the amount of CO2 it produces"
) +
geom_smooth(method="lm")
~~~
{: .language-r}



~~~
`geom_smooth()` using formula 'y ~ x'
~~~
{: .output}

<img src="../fig/rmd-01-unnamed-chunk-25-1.png" title="plot of chunk unnamed-chunk-25" alt="plot of chunk unnamed-chunk-25" width="612" style="display: block; margin: auto;" />

For the second question, we want to create two groups - Canada, the United States, and Mexico in one and the other countries in another. We can create a grouping variable using `mutate`


~~~
gapminder_co2 %>%
mutate(region = if_else(country == "Canada" | country == "United States" | country == "Mexico", "north", "south"))
~~~
{: .language-r}



~~~
[90m# A tibble: 24 x 7[39m
   country            lifeExp gdpPercap       pop   total per_capita region
   [3m[90m<chr>[39m[23m                [3m[90m<dbl>[39m[23m     [3m[90m<dbl>[39m[23m     [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m      [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m 
[90m 1[39m Argentina             75.3    [4m1[24m[4m2[24m779.  40[4m3[24m[4m0[24m[4m1[24m927 [4m1[24m[4m4[24m[4m9[24m476.      3.82  south 
[90m 2[39m Bolivia               65.6     [4m3[24m822.   9[4m1[24m[4m1[24m[4m9[24m152   [4m8[24m976.      0.984 south 
[90m 3[39m Brazil                72.4     [4m9[24m066. 190[4m0[24m[4m1[24m[4m0[24m647 [4m3[24m[4m1[24m[4m1[24m624.      1.67  south 
[90m 4[39m Canada                80.7    [4m3[24m[4m6[24m319.  33[4m3[24m[4m9[24m[4m0[24m141 [4m5[24m[4m4[24m[4m0[24m431.     16.8   north 
[90m 5[39m Chile                 78.6    [4m1[24m[4m3[24m172.  16[4m2[24m[4m8[24m[4m4[24m741  [4m5[24m[4m4[24m435.      3.34  south 
[90m 6[39m Colombia              72.9     [4m7[24m007.  44[4m2[24m[4m2[24m[4m7[24m550  [4m5[24m[4m3[24m585.      1.24  south 
[90m 7[39m Costa Rica            78.8     [4m9[24m645.   4[4m1[24m[4m3[24m[4m3[24m884   [4m5[24m463.      1.29  south 
[90m 8[39m Cuba                  78.3     [4m8[24m948.  11[4m4[24m[4m1[24m[4m6[24m987  [4m2[24m[4m5[24m051.      2.22  south 
[90m 9[39m Dominican Republic    72.2     [4m6[24m025.   9[4m3[24m[4m1[24m[4m9[24m622  [4m1[24m[4m7[24m522.      1.90  south 
[90m10[39m Ecuador               75.0     [4m6[24m873.  13[4m7[24m[4m5[24m[4m5[24m680  [4m2[24m[4m3[24m927.      1.74  south 
[90m# â€¦ with 14 more rows[39m
~~~
{: .output}

Then we can use this column to repeat our `group_by` and `summarize` steps


~~~
gapminder_co2 %>%
mutate(region = if_else(country == "Canada" | country == "United States" | country == "Mexico", "north", "south")) %>%
group_by(region) %>%
summarize(total = sum(total))
~~~
{: .language-r}



~~~
`summarise()` ungrouping output (override with `.groups` argument)
~~~
{: .output}



~~~
[90m# A tibble: 2 x 2[39m
  region    total
  [3m[90m<chr>[39m[23m     [3m[90m<dbl>[39m[23m
[90m1[39m north  6[4m6[24m[4m5[24m[4m6[24m037.
[90m2[39m south   [4m8[24m[4m8[24m[4m9[24m332.
~~~
{: .output}

We see that although Canada, the United States, and Mexico account for half the population of the Americas, they account for 88% of the CO2 emitted. In fact, the United States accounts for 75% of the CO2 emitted from the Americas.


## Exercises
* Show that Canada, the United States, and Mexico account for half the population
* Show that the United States accounts for 75% of the CO2 emitted from the Americas
* Create an R script file that contains the code to clean up the gapminder and CO2 emissions data, joins the data frame and builds the plot ad summary table comparing Canada, the United States, and Mexico to the rest of the Americas. Be sure to commit your new file and push your updated repository to GitHub!
